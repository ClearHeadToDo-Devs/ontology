<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integration Guide - Actions Vocabulary</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
            color: #333;
        }
        .nav-breadcrumb {
            color: #6c757d;
            margin-bottom: 1rem;
        }
        .nav-breadcrumb a {
            color: #007bff;
            text-decoration: none;
        }
        pre {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            border-left: 4px solid #007bff;
        }
        .example-card {
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .example-card h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .code-tabs {
            display: flex;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 1rem;
        }
        .code-tab {
            padding: 0.5rem 1rem;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-bottom: none;
            cursor: pointer;
            border-radius: 4px 4px 0 0;
        }
        .code-tab.active {
            background: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        .toc {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 6px;
            margin: 2rem 0;
        }
        .toc ul {
            margin: 0;
            padding-left: 1.5rem;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="nav-breadcrumb">
        <a href="../">Clearhead Vocabularies</a> > <a href="../actions/">Actions</a> > Integration Guide
    </div>

    <h1>Integration Guide</h1>
    <p>Comprehensive guide for integrating the Actions Vocabulary into your applications, APIs, and databases.</p>

    <div class="toc">
        <h3>Table of Contents</h3>
        <ul>
            <li><a href="#web-apis">Web APIs & REST Services</a></li>
            <li><a href="#databases">Database Integration</a></li>
            <li><a href="#type-generation">Type Generation</a></li>
            <li><a href="#validation">Data Validation</a></li>
            <li><a href="#semantic-processing">Semantic Processing</a></li>
            <li><a href="#best-practices">Best Practices</a></li>
        </ul>
    </div>

    <section id="web-apis">
        <h2>üåê Web APIs & REST Services</h2>

        <div class="example-card">
            <h3>OpenAPI Integration</h3>
            <p>Use the JSON schemas directly in your OpenAPI specifications:</p>
            
            <pre><code>openapi: 3.0.3
info:
  title: Task Management API
  version: 1.0.0

components:
  schemas:
    Action:
      $ref: 'https://vocab.clearhead.io/actions/schemas/action.schema.json'
    
    RootAction:
      $ref: 'https://vocab.clearhead.io/actions/schemas/rootaction.schema.json'
    
    CreateActionRequest:
      allOf:
        - $ref: '#/components/schemas/Action'
        - required: [name, priority]
        - properties:
            uuid:
              readOnly: true

paths:
  /actions:
    post:
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateActionRequest'
      responses:
        '201':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Action'</code></pre>
        </div>

        <div class="example-card">
            <h3>Express.js Integration</h3>
            <pre><code>const express = require('express');
const Ajv = require('ajv');
const fetch = require('node-fetch');

const app = express();
app.use(express.json());

// Load schema once at startup
let actionSchema;
(async () => {
  const response = await fetch('https://vocab.clearhead.io/actions/schemas/action.schema.json');
  actionSchema = await response.json();
})();

const ajv = new Ajv();

app.post('/actions', (req, res) => {
  // Validate request body
  const validate = ajv.compile(actionSchema);
  const valid = validate(req.body);
  
  if (!valid) {
    return res.status(400).json({
      error: 'Invalid action data',
      details: validate.errors
    });
  }
  
  // Process valid action...
  res.status(201).json(req.body);
});</code></pre>
        </div>

        <div class="example-card">
            <h3>FastAPI Integration</h3>
            <pre><code>from fastapi import FastAPI, HTTPException
from pydantic import BaseModel, Field, validator
from typing import Optional
import uuid
import re

app = FastAPI(title="Task Management API")

class Action(BaseModel):
    uuid: str = Field(..., regex=r'^[0-9a-f]{8}-[0-9a-f]{4}-7[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$')
    name: str = Field(..., min_length=1)
    priority: int = Field(..., ge=1, le=4)
    state: str
    context: Optional[str] = Field(None, regex=r'^@[a-zA-Z0-9_-]+$')
    duration_minutes: Optional[int] = Field(None, ge=1, le=10080)
    
    class Config:
        schema_extra = {
            "example": {
                "uuid": "01936194-d5b0-7890-8000-123456789abc",
                "name": "Review quarterly reports",
                "priority": 2,
                "state": "active",
                "context": "@office",
                "duration_minutes": 90
            }
        }

@app.post("/actions", response_model=Action)
async def create_action(action: Action):
    # Action is automatically validated by Pydantic
    return action</code></pre>
        </div>
    </section>

    <section id="databases">
        <h2>üóÑÔ∏è Database Integration</h2>

        <div class="example-card">
            <h3>PostgreSQL Schema</h3>
            <pre><code>-- Generated from Actions Vocabulary JSON Schema
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE actions (
    -- Core properties
    uuid UUID PRIMARY KEY DEFAULT uuid_generate_v7(),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    priority INTEGER CHECK (priority BETWEEN 1 AND 4) NOT NULL,
    state VARCHAR(50) NOT NULL,
    
    -- Hierarchy
    parent_action_uuid UUID REFERENCES actions(uuid),
    depth INTEGER CHECK (depth BETWEEN 0 AND 5),
    project VARCHAR(255),
    
    -- Context and timing
    context VARCHAR(100) CHECK (context ~ '^@[a-zA-Z0-9_-]+$'),
    duration_minutes INTEGER CHECK (duration_minutes BETWEEN 1 AND 10080),
    
    -- Dates and times
    do_date DATE,
    do_time TIME,
    due_date DATE,
    due_time TIME,
    do_datetime TIMESTAMPTZ,
    due_datetime TIMESTAMPTZ,
    completed_datetime TIMESTAMPTZ,
    
    -- Recurrence (iCalendar RRULE compatible)
    recurrence_frequency VARCHAR(20) CHECK (recurrence_frequency IN ('DAILY', 'WEEKLY', 'MONTHLY', 'YEARLY')),
    recurrence_interval INTEGER CHECK (recurrence_interval >= 1),
    recurrence_count INTEGER,
    recurrence_until TIMESTAMPTZ,
    by_day VARCHAR(50),
    by_hour VARCHAR(50),
    by_minute VARCHAR(50),
    by_month VARCHAR(50),
    by_month_day VARCHAR(50),
    
    -- Metadata
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes for common queries
CREATE INDEX idx_actions_parent ON actions(parent_action_uuid);
CREATE INDEX idx_actions_project ON actions(project);
CREATE INDEX idx_actions_state ON actions(state);
CREATE INDEX idx_actions_priority ON actions(priority);
CREATE INDEX idx_actions_context ON actions(context);
CREATE INDEX idx_actions_do_date ON actions(do_date);
CREATE INDEX idx_actions_due_date ON actions(due_date);

-- Constraints to enforce vocabulary rules
ALTER TABLE actions ADD CONSTRAINT chk_root_no_parent 
    CHECK ((depth = 0 AND parent_action_uuid IS NULL) OR depth > 0);

ALTER TABLE actions ADD CONSTRAINT chk_child_has_parent
    CHECK ((depth > 0 AND parent_action_uuid IS NOT NULL) OR depth = 0);

ALTER TABLE actions ADD CONSTRAINT chk_project_only_root
    CHECK ((depth = 0 AND project IS NOT NULL) OR (depth > 0 AND project IS NULL));</code></pre>
        </div>

        <div class="example-card">
            <h3>MongoDB Schema</h3>
            <pre><code>// MongoDB schema validation using JSON Schema
db.createCollection("actions", {
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: ["name", "priority", "state"],
      properties: {
        uuid: {
          bsonType: "string",
          pattern: "^[0-9a-f]{8}-[0-9a-f]{4}-7[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"
        },
        name: { bsonType: "string", minLength: 1 },
        priority: { bsonType: "int", minimum: 1, maximum: 4 },
        state: { bsonType: "string" },
        context: {
          bsonType: ["string", "null"],
          pattern: "^@[a-zA-Z0-9_-]+$"
        },
        durationMinutes: {
          bsonType: ["int", "null"],
          minimum: 1,
          maximum: 10080
        },
        parentAction: { bsonType: ["string", "null"] },
        project: { bsonType: ["string", "null"] }
      }
    }
  }
});

// Indexes
db.actions.createIndex({ "parentAction": 1 });
db.actions.createIndex({ "project": 1 });
db.actions.createIndex({ "state": 1 });
db.actions.createIndex({ "priority": 1 });
db.actions.createIndex({ "context": 1 });</code></pre>
        </div>
    </section>

    <section id="type-generation">
        <h2>‚ö° Type Generation</h2>

        <div class="example-card">
            <h3>TypeScript Types</h3>
            <p>Generate TypeScript types from JSON Schema:</p>
            
            <pre><code># Install json-schema-to-typescript
npm install -D json-schema-to-typescript

# Generate types
json2ts -i https://vocab.clearhead.io/actions/schemas/actions-combined.schema.json -o types/actions.ts</code></pre>

            <p>Generated TypeScript interfaces:</p>
            <pre><code>interface Action {
  uuid: string; // UUID v7 pattern
  name: string;
  description?: string;
  priority: 1 | 2 | 3 | 4;
  state: string;
  context?: string; // @context pattern
  durationMinutes?: number; // 1-10080
  parentAction?: string;
  project?: string;
  
  // Temporal properties
  doDate?: string;
  doTime?: string;
  dueDate?: string;
  dueTime?: string;
  doDateTime?: string;
  dueDateTime?: string;
  completedDateTime?: string;
  
  // Recurrence properties
  recurrenceFrequency?: 'DAILY' | 'WEEKLY' | 'MONTHLY' | 'YEARLY';
  recurrenceInterval?: number;
  recurrenceCount?: string;
  recurrenceUntil?: string;
  byDay?: string;
  byHour?: string;
  byMinute?: string;
  byMonth?: string;
  byMonthDay?: string;
  
  depth?: string;
}

interface RootAction extends Action {
  project?: string;
  parentAction?: undefined;
}

interface ChildAction extends Action {
  parentAction: string; // Required for child actions
}

interface LeafAction extends Action {
  parentAction: string; // Required for leaf actions
}</code></pre>
        </div>

        <div class="example-card">
            <h3>Rust Types</h3>
            <p>Generate Rust structs using serde and schemars:</p>
            
            <pre><code>use serde::{Deserialize, Serialize};
use uuid::Uuid;

#[derive(Debug, Serialize, Deserialize)]
pub struct Action {
    pub uuid: Uuid,
    pub name: String,
    pub description: Option<String>,
    pub priority: u8, // 1-4
    pub state: String,
    pub context: Option<String>,
    pub duration_minutes: Option<u16>, // 1-10080
    pub parent_action: Option<Uuid>,
    pub project: Option<String>,
    
    // Temporal
    pub do_date: Option<String>,
    pub do_time: Option<String>,
    pub due_date: Option<String>,
    pub due_time: Option<String>,
    pub do_date_time: Option<chrono::DateTime<chrono::Utc>>,
    pub due_date_time: Option<chrono::DateTime<chrono::Utc>>,
    pub completed_date_time: Option<chrono::DateTime<chrono::Utc>>,
    
    // Recurrence
    pub recurrence_frequency: Option<RecurrenceFrequency>,
    pub recurrence_interval: Option<u32>,
    pub recurrence_count: Option<String>,
    pub recurrence_until: Option<chrono::DateTime<chrono::Utc>>,
    
    pub depth: Option<u8>,
}

#[derive(Debug, Serialize, Deserialize)]
pub enum RecurrenceFrequency {
    #[serde(rename = "DAILY")]
    Daily,
    #[serde(rename = "WEEKLY")]
    Weekly,
    #[serde(rename = "MONTHLY")]
    Monthly,
    #[serde(rename = "YEARLY")]
    Yearly,
}</code></pre>
        </div>
    </section>

    <section id="validation">
        <h2>‚úÖ Data Validation</h2>

        <div class="example-card">
            <h3>JSON Schema Validation</h3>
            <pre><code>import json
import requests
from jsonschema import validate, ValidationError

# Load schema
schema_url = "https://vocab.clearhead.io/actions/schemas/action.schema.json"
schema = requests.get(schema_url).json()

# Validate data
action_data = {
    "uuid": "01936194-d5b0-7890-8000-123456789abc",
    "name": "Review quarterly reports",
    "priority": 2,
    "state": "active"
}

try:
    validate(instance=action_data, schema=schema)
    print("‚úÖ Valid action data")
except ValidationError as e:
    print(f"‚ùå Validation error: {e.message}")
    print(f"   Path: {' -> '.join(str(p) for p in e.absolute_path)}")</code></pre>
        </div>

        <div class="example-card">
            <h3>SHACL Validation</h3>
            <pre><code>from pyshacl import validate
from rdflib import Graph

# Load data and shapes
data_graph = Graph()
data_graph.parse("my-actions.ttl", format="turtle")

shapes_graph = Graph()
shapes_graph.parse("https://vocab.clearhead.io/actions/shapes.ttl", format="turtle")

# Validate
conforms, results_graph, results_text = validate(
    data_graph,
    shacl_graph=shapes_graph,
    inference='rdfs',
    debug=True
)

if conforms:
    print("‚úÖ Data conforms to SHACL shapes")
else:
    print("‚ùå SHACL validation errors:")
    print(results_text)</code></pre>
        </div>
    </section>

    <section id="semantic-processing">
        <h2>üß† Semantic Processing</h2>

        <div class="example-card">
            <h3>SPARQL Queries</h3>
            <pre><code>PREFIX actions: &lt;https://vocab.clearhead.io/actions/&gt;
PREFIX rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;

# Find all root actions with high priority
SELECT ?action ?name ?project WHERE {
    ?action a actions:RootAction ;
            actions:name ?name ;
            actions:priority ?priority ;
            actions:project ?project .
    FILTER(?priority <= 2)
    FILTER(?project != "")
}

# Find action hierarchy depth
SELECT ?action ?name ?depth WHERE {
    ?action a actions:Action ;
            actions:name ?name .
    
    # Count parent chain length  
    {
        SELECT ?action (COUNT(?parent) as ?depth) WHERE {
            ?action actions:parentAction* ?parent .
        } GROUP BY ?action
    }
}</code></pre>
        </div>

        <div class="example-card">
            <h3>RDFLib Processing</h3>
            <pre><code>from rdflib import Graph, Namespace, Literal
from rdflib.namespace import RDF, RDFS

# Load vocabulary
g = Graph()
g.parse("https://vocab.clearhead.io/actions/vocabulary.ttl", format="turtle")

# Define namespace
ACTIONS = Namespace("https://vocab.clearhead.io/actions/")
g.bind("actions", ACTIONS)

# Query for all Action classes
action_classes = list(g.subjects(RDF.type, RDFS.Class))
print("Action classes:")
for cls in action_classes:
    if ACTIONS in cls:
        label = g.value(cls, RDFS.label) or cls.split('/')[-1]
        comment = g.value(cls, RDFS.comment)
        print(f"  {label}: {comment}")

# Query for properties
properties = list(g.subjects(RDF.type, RDF.Property))
print("\nAction properties:")
for prop in properties:
    if ACTIONS in prop:
        label = g.value(prop, RDFS.label) or prop.split('/')[-1]  
        comment = g.value(prop, RDFS.comment)
        print(f"  {label}: {comment}")</code></pre>
        </div>
    </section>

    <section id="best-practices">
        <h2>üìã Best Practices</h2>

        <div class="success">
            <h3>‚úÖ Recommended Practices</h3>
            <ul>
                <li><strong>Use Version 7 UUIDs</strong> - Provides temporal ordering and uniqueness</li>
                <li><strong>Validate at boundaries</strong> - Use JSON Schema for API validation, SHACL for semantic validation</li>
                <li><strong>Cache schemas</strong> - Download schemas once at application startup</li>
                <li><strong>Handle hierarchy carefully</strong> - Validate parent-child relationships</li>
                <li><strong>Use content negotiation</strong> - Request appropriate format for your use case</li>
                <li><strong>Implement proper error handling</strong> - Provide meaningful validation error messages</li>
            </ul>
        </div>

        <div class="warning">
            <h3>‚ö†Ô∏è Common Pitfalls</h3>
            <ul>
                <li><strong>Don't ignore depth constraints</strong> - Maximum hierarchy depth is 5 levels</li>
                <li><strong>Don't mix root and child properties</strong> - Only root actions can have projects</li>
                <li><strong>Don't skip UUID validation</strong> - Ensure proper Version 7 UUID format</li>
                <li><strong>Don't forget context validation</strong> - Context tags must start with @</li>
                <li><strong>Don't exceed duration limits</strong> - Maximum duration is 1 week (10,080 minutes)</li>
            </ul>
        </div>

        <div class="example-card">
            <h3>Error Handling Pattern</h3>
            <pre><code>import jsonschema

def validate_action(action_data, schema):
    """Validate action data with detailed error reporting."""
    try:
        jsonschema.validate(action_data, schema)
        return {"valid": True}
    except jsonschema.ValidationError as e:
        return {
            "valid": False,
            "error": e.message,
            "path": list(e.absolute_path),
            "invalid_value": e.instance,
            "constraint": e.validator,
            "schema_path": list(e.schema_path)
        }
    except Exception as e:
        return {
            "valid": False,
            "error": f"Unexpected validation error: {str(e)}"
        }

# Usage
result = validate_action(action_data, action_schema)
if not result["valid"]:
    print(f"Validation failed: {result['error']}")
    if "path" in result:
        print(f"Field: {'.'.join(result['path'])}")
        print(f"Invalid value: {result['invalid_value']}")</code></pre>
        </div>
    </section>

    <footer style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #e1e5e9; text-align: center; color: #6c757d;">
        <p><a href="../actions/">‚Üê Back to Actions Vocabulary</a> | <a href="../">Clearhead Vocabularies</a></p>
    </footer>
</body>
</html>